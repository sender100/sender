<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Simple Data Share</title>
  <script type="module">
    // --- Firebase Import (v11 Modular) ---
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getDatabase, ref, set, get, child, remove } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

    // --- Your Firebase Config (replace with your own project config) ---
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT.firebaseapp.com",
      databaseURL: "https://YOUR_PROJECT.firebaseio.com",
      projectId: "YOUR_PROJECT",
      storageBucket: "YOUR_PROJECT.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    // --- Init Firebase ---
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // --- Generate random ID for sharing ---
    function makeId(len = 6) {
      const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
      let res = "";
      for (let i = 0; i < len; i++) res += chars.charAt(Math.floor(Math.random() * chars.length));
      return res;
    }

    // --- Send Data ---
    async function sendData() {
      const fileInput = document.getElementById("fileInput");
      if (!fileInput.files.length) {
        alert("Select a file first!");
        return;
      }
      const file = fileInput.files[0];
      if (file.size > 12 * 1024 * 1024) {
        alert("File too large! Max 12 MB allowed.");
        return;
      }

      const reader = new FileReader();
      reader.onload = async function(e) {
        const base64Data = e.target.result;
        const id = makeId();
        await set(ref(db, "files/" + id), {
          name: file.name,
          type: file.type,
          data: base64Data
        });
        document.getElementById("shareId").innerText = "Your Share ID: " + id;
      };
      reader.readAsDataURL(file);
    }

    // --- Receive Data ---
    async function receiveData() {
      const id = document.getElementById("receiveId").value.trim();
      if (!id) {
        alert("Enter a Share ID!");
        return;
      }
      const snap = await get(child(ref(db), "files/" + id));
      if (!snap.exists()) {
        alert("No data found for this ID!");
        return;
      }
      const fileData = snap.val();
      const a = document.createElement("a");
      a.href = fileData.data;
      a.download = fileData.name;
      a.click();
    }

    // --- Clear DB (optional admin action) ---
    async function clearAll() {
      await remove(ref(db, "files"));
      alert("All data cleared!");
    }

    // Attach buttons
    window.sendData = sendData;
    window.receiveData = receiveData;
    window.clearAll = clearAll;
  </script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      text-align: center;
      padding: 50px;
    }
    .box {
      background: rgba(0,0,0,0.4);
      padding: 20px;
      border-radius: 12px;
      margin: 20px auto;
      max-width: 500px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }
    button {
      background: #ff7eb3;
      border: none;
      padding: 10px 20px;
      margin: 10px;
      border-radius: 8px;
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: 0.3s;
    }
    button:hover {
      background: #ff4f81;
    }
    input {
      padding: 10px;
      border-radius: 6px;
      border: none;
      width: 80%;
      margin: 10px;
    }
  </style>
</head>
<body>
  <h1>ðŸ”¥ Simple Data Share</h1>
  
  <div class="box">
    <h2>Send File</h2>
    <input type="file" id="fileInput" />
    <br>
    <button onclick="sendData()">Send</button>
    <p id="shareId"></p>
  </div>

  <div class="box">
    <h2>Receive File</h2>
    <input type="text" id="receiveId" placeholder="Enter Share ID" />
    <br>
    <button onclick="receiveData()">Receive</button>
  </div>

  <div class="box">
    <h2>Admin</h2>
    <button onclick="clearAll()">Clear All</button>
  </div>
</body>
</html>
