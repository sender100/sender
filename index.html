<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Universal File Sender & Receiver</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{--bg1:#6ee7f9;--bg2:#a7b7ff;--card:#ffffff;--txt:#1f2937;--pri:#2563eb;--priH:#1d4ed8;--ok:#16a34a;--warn:#d97706;--err:#dc2626}
    body{
      margin:0;padding:24px;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      color:var(--txt);
      background:linear-gradient(135deg,var(--bg1),var(--bg2)) fixed;
    }
    .app{max-width:980px;margin:0 auto}
    h1{margin:0 0 8px 0}
    .sub{opacity:.85;margin-bottom:24px}
    .grid{display:grid;grid-template-columns:1fr;gap:18px}
    @media(min-width:900px){.grid{grid-template-columns:1fr 1fr}}
    .card{
      background:var(--card);border-radius:16px;box-shadow:0 12px 40px rgba(0,0,0,.12);
      padding:20px 18px 18px
    }
    .card h2{margin:0 0 12px}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .input, select{
      flex:1;min-width:200px;padding:12px 14px;border:1px solid #e5e7eb;border-radius:10px;font-size:15px
    }
    .btn{
      padding:11px 14px;border:0;border-radius:10px;background:var(--pri);color:#fff;font-weight:600;cursor:pointer
    }
    .btn:hover{background:var(--priH)}
    .btn.ghost{background:#eef2ff;color:#111}
    .muted{font-size:13px;opacity:.8}
    .ok{color:var(--ok)} .warn{color:var(--warn)} .err{color:var(--err)}
    .list{margin-top:12px;border-top:1px dashed #e5e7eb;padding-top:10px;max-height:300px;overflow:auto}
    .item{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:8px 0;border-bottom:1px solid #f3f4f6}
    .name{font-weight:600}
    .meta{font-size:12px;opacity:.75}
    .dl{padding:8px 10px;border-radius:8px;background:#10b981;color:#fff;text-decoration:none}
    .progress{height:10px;background:#f3f4f6;border-radius:999px;overflow:hidden;margin-top:10px}
    .bar{height:10px;width:0;background:linear-gradient(90deg,#60a5fa,#34d399)}
    .tag{background:#f1f5f9;border-radius:999px;padding:4px 10px;font-size:12px}
    .hr{height:1px;background:#e5e7eb;margin:14px 0}
    .tips{font-size:12px;opacity:.8;line-height:1.5}
    .pill{display:inline-flex;align-items:center;gap:6px;background:#f8fafc;border:1px solid #e5e7eb;border-radius:999px;padding:6px 10px}
    .copy{cursor:pointer;padding:6px 10px;border-radius:8px;border:1px solid #e5e7eb;background:#fff}
  </style>
</head>
<body>
  <div class="app">
    <h1>üì¶ File Sender & Receiver</h1>
    <div class="sub">‡§è‡§ï ‡§π‡•Ä ‡§∏‡§æ‡§á‡§ü link ‡§ú‡§π‡§æ‡§Å ‡§≠‡•Ä ‡§ñ‡•ã‡§≤‡•á ‚Äî ‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä PC/Phone ‡§™‡§∞ ‚Äî ID ‡§ï‡•á ‡§ú‡§º‡§∞‡§ø‡§Ø‡•á files ‡§¶‡§ø‡§ñ‡•á‡§Ç ‡§î‡§∞ download ‡§π‡•ã‡§Ç. Cloud storage ‡§∏‡•á permanent. ‚úÖ</div>

    <div class="grid">
      <!-- Sender -->
      <div class="card">
        <h2>Sender</h2>
        <div class="row">
          <input id="senderId" class="input" placeholder="Receiver ID ‡§≤‡§ø‡§ñ‡•á‡§Ç (e.g. 728913 ‡§Ø‡§æ team-alpha)" />
          <button id="genId" class="btn ghost" title="Random ID">Generate ID</button>
          <button id="copyId" class="btn ghost" title="Copy ID">Copy ID</button>
        </div>

        <div class="row">
          <input id="fileInput" type="file" class="input" />
        </div>
        <div class="row">
          <select id="expires" class="input">
            <option value="never">Expiry: Never</option>
            <option value="7d">Expiry: 7 days</option>
            <option value="24h">Expiry: 24 hours</option>
          </select>
          <button id="sendBtn" class="btn">Send File</button>
        </div>

        <div id="status" class="muted"></div>
        <div class="progress" style="display:none" id="progWrap"><div id="progBar" class="bar"></div></div>
        <div class="tips">
          Tip: ‡§µ‡§π‡•Ä ID Receiver ‡§ï‡•ã ‡§¶‡•á ‡§¶‡•ã. ‡§µ‡§π‡•Ä ID ‡§π‡§∞ device ‡§™‡§∞ ‡§°‡§æ‡§≤‡§ï‡§∞ files ‡§¶‡§ø‡§ñ‡•á‡§Ç‡§ó‡•Ä.  
          Max recommended size: ~50‚Äì100MB (browser/mobile limitation ‡§™‡§∞ depend ‡§ï‡§∞‡§§‡§æ ‡§π‡•à).
        </div>
      </div>

      <!-- Receiver -->
      <div class="card">
        <h2>Receiver</h2>
        <div class="row">
          <input id="receiverId" class="input" placeholder="Receiver ID ‡§°‡§æ‡§≤‡•á‡§Ç" />
          <button id="loginBtn" class="btn">Login</button>
          <label class="pill"><input type="checkbox" id="live" checked /> Live updates</label>
        </div>
        <div id="rxNote" class="muted"></div>
        <div id="fileList" class="list"></div>
      </div>
    </div>

    <div class="card">
      <h3>How it works (short)</h3>
      <div class="tips">
        Files Firebase Storage ‡§Æ‡•á‡§Ç upload ‡§π‡•ã‡§§‡•Ä ‡§π‡•à‡§Ç. ‡§â‡§®‡§ï‡•á download links Realtime Database ‡§Æ‡•á‡§Ç ‡§Ü‡§™‡§ï‡•Ä ID ‡§ï‡•Ä path ‡§™‡§∞ store ‡§π‡•ã‡§§‡•á ‡§π‡•à‡§Ç.
        Receiver ‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä device ‡§∏‡•á same ID ‡§°‡§æ‡§≤‡§ï‡§∞ list ‡§¶‡•á‡§ñ ‡§∏‡§ï‡§§‡§æ/‡§∏‡§ï‡§§‡•Ä ‡§π‡•à. Refresh ‡§Ø‡§æ device change ‡§™‡§∞ ‡§≠‡•Ä data ‡§∞‡§π‡§§‡§æ ‡§π‡•à.
      </div>
    </div>
  </div>

  <!-- Firebase (Compat SDKs for simplicity) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>

  <script>
    // üîß Put YOUR Firebase config here (using the one you shared, with fixes)
    const firebaseConfig = {
      apiKey: "AIzaSyD_h6xku4yrCgSUwk1bllmu8D16yB5MHNY",
      authDomain: "sender-c0add.firebaseapp.com",
      databaseURL: "https://sender-c0add-default-rtdb.firebaseio.com",
      projectId: "sender-c0add",
      storageBucket: "sender-c0add.appspot.com", // IMPORTANT: .appspot.com
      messagingSenderId: "319016706425",
      appId: "1:319016706425:web:b1f28312da7d9c6ea64fa8"
    };

    // Init
    const app = firebase.initializeApp(firebaseConfig);
    const db  = firebase.database();
    const st  = firebase.storage();

    // UI refs
    const senderId  = document.getElementById('senderId');
    const genIdBtn  = document.getElementById('genId');
    const copyIdBtn = document.getElementById('copyId');
    const fileInput = document.getElementById('fileInput');
    const sendBtn   = document.getElementById('sendBtn');
    const statusEl  = document.getElementById('status');
    const progWrap  = document.getElementById('progWrap');
    const progBar   = document.getElementById('progBar');
    const expires   = document.getElementById('expires');

    const receiverId= document.getElementById('receiverId');
    const loginBtn  = document.getElementById('loginBtn');
    const fileList  = document.getElementById('fileList');
    const rxNote    = document.getElementById('rxNote');
    const liveChk   = document.getElementById('live');

    // Helpers
    const fmt = (n)=> new Intl.NumberFormat().format(n);
    function humanSize(bytes){
      const u=['B','KB','MB','GB','TB']; let i=0, v=bytes||0;
      while(v>=1024 && i<u.length-1){v/=1024;i++}
      return `${v.toFixed(v<10&&i>0?2:0)} ${u[i]}`;
    }
    function randId(){
      const part = Math.random().toString(36).slice(2,7);
      const num  = Math.floor(100000 + Math.random()*900000);
      return `${num}-${part}`;
    }
    function show(msg, cls=''){ statusEl.innerHTML=`<span class="${cls}">${msg}</span>` }

    genIdBtn.onclick = ()=> senderId.value = randId();
    copyIdBtn.onclick = async ()=>{
      if(!senderId.value.trim()){ show('‡§™‡§π‡§≤‡•á ‡§ï‡•ã‡§à ID ‡§≤‡§ø‡§ñ‡•ã ‡§Ø‡§æ Generate ‡§ï‡§∞‡•ã.', 'warn'); return; }
      await navigator.clipboard.writeText(senderId.value.trim());
      show('ID copied ‚úÖ', 'ok');
    };

    // Upload
    sendBtn.onclick = async ()=>{
      const id = (senderId.value||'').trim();
      const f  = fileInput.files[0];
      if(!id){ show('Receiver ID ‡§°‡§æ‡§≤‡•ã.','warn'); return; }
      if(!f){ show('‡§ï‡•É‡§™‡§Ø‡§æ ‡§ï‡•ã‡§à file ‡§ö‡•Å‡§®‡•ã.','warn'); return; }

      // Basic size guard (optional)
      const MAX = 1024*1024*250; // ~250MB soft cap
      if(f.size > MAX){ show(`File ‡§¨‡§π‡•Å‡§§ ‡§¨‡§°‡§º‡•Ä ‡§π‡•à (${humanSize(f.size)}). ‡§ï‡•ã‡§∂‡§ø‡§∂ ‡§ï‡§∞‡•ã ${humanSize(MAX)} ‡§§‡§ï.`, 'err'); return; }

      // Expiry calculation
      let ttl = null;
      const now = Date.now();
      if(expires.value === '7d') ttl = now + 7*24*60*60*1000;
      if(expires.value === '24h') ttl = now + 24*60*60*1000;

      try{
        const path = `${encodeURIComponent(id)}/${Date.now()}-${f.name}`;
        const ref  = st.ref(path);
        const task = ref.put(f);

        progWrap.style.display='block';
        progBar.style.width='0';

        task.on('state_changed', snap=>{
          const pct = (snap.bytesTransferred / snap.totalBytes) * 100;
          progBar.style.width = pct.toFixed(2)+'%';
        }, err=>{
          show('Upload error: '+err.message, 'err');
          progWrap.style.display='none';
        }, async ()=>{
          const url = await task.snapshot.ref.getDownloadURL();
          const meta = {
            name: f.name,
            size: f.size,
            type: f.type || 'file',
            url,
            path,
            ts: Date.now(),
            ttl: ttl || null
          };
          await db.ref(`files/${encodeURIComponent(id)}`).push(meta);
          show(`‚úÖ Uploaded & saved for ID: <b>${id}</b>`, 'ok');
          fileInput.value = '';
          setTimeout(()=>{ progWrap.style.display='none'; }, 400);
        });

      }catch(e){
        show('‡§ï‡•Å‡§õ ‡§ó‡§°‡§º‡§¨‡§°‡§º ‡§π‡•à: '+e.message, 'err');
        progWrap.style.display='none';
      }
    };

    // Receiver listing
    let unsub = null;
    function renderList(id, snap){
      fileList.innerHTML = '';
      if(!snap || !snap.exists()){
        fileList.innerHTML = '<div class="muted">No files for this ID (yet).</div>';
        return;
      }
      const data = snap.val();
      // Turn into array
      const items = Object.entries(data).map(([key,val])=>({key,...val}));
      // Filter expired if ttl set
      const now = Date.now();
      const filtered = items.filter(it => !it.ttl || it.ttl > now);
      // Newest first
      filtered.sort((a,b)=> b.ts - a.ts);

      if(filtered.length===0){
        fileList.innerHTML = '<div class="muted">No files (maybe expired).</div>';
        return;
      }

      for(const it of filtered){
        const row = document.createElement('div');
        row.className='item';
        row.innerHTML = `
          <div>
            <div class="name">${it.name}</div>
            <div class="meta">${humanSize(it.size)} ‚Ä¢ ${new Date(it.ts).toLocaleString()} ${it.ttl?`‚Ä¢ Expires: ${new Date(it.ttl).toLocaleString()}`:''}</div>
          </div>
          <div class="row" style="gap:8px">
            <a class="dl" href="${it.url}" download="${it.name}">Download</a>
          </div>
        `;
        fileList.appendChild(row);
      }
    }

    function startLive(id){
      const ref = db.ref(`files/${encodeURIComponent(id)}`);
      if(unsub) unsub(); // cleanup old
      ref.off();
      const cb = snap => renderList(id, snap);
      ref.on('value', cb);
      unsub = ()=> ref.off('value', cb);
    }
    function oneTime(id){
      if(unsub) { unsub(); unsub=null; }
      const ref = db.ref(`files/${encodeURIComponent(id)}`);
      ref.once('value').then(snap=>renderList(id,snap));
    }

    loginBtn.onclick = ()=>{
      const id = (receiverId.value||'').trim();
      if(!id){ rxNote.innerHTML = '<span class="warn">Receiver ID ‡§°‡§æ‡§≤‡•á‡§Ç.</span>'; return; }
      rxNote.innerHTML = `<span class="ok">Logged into ID: <b>${id}</b></span>`;
      if(liveChk.checked) startLive(id); else oneTime(id);
    };
    liveChk.onchange = ()=>{
      const id = (receiverId.value||'').trim();
      if(!id) return;
      if(liveChk.checked) startLive(id); else oneTime(id);
    };
  </script>
</body>
</html>
