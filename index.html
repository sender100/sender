<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>‚ö° Realtime File Share ‚Äî Simple Pro (12MB)</title>

  <!-- Tailwind CSS -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet"/>
  <!-- Animate.css -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet"/>
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet"/>

  <style>
    :root{ --indigo:#6366f1; --emerald:#10b981; --blue:#2563eb; --red:#ef4444 }
    *{ box-sizing:border-box }
    body{ font-family:'Poppins',sans-serif; overflow-x:hidden }
    h1,h2{ font-family:'Orbitron',sans-serif }

    /* Animated gradient background */
    .bg-animated{ background: linear-gradient(120deg, #0ea5e9, #6366f1, #22c55e, #06b6d4); background-size: 400% 400%; animation: gradientShift 18s ease infinite; min-height:100vh }
    @keyframes gradientShift{ 0%{ background-position: 0% 50% } 50%{ background-position: 100% 50% } 100%{ background-position: 0% 50% } }

    /* Glass */
    .glass{ backdrop-filter: blur(12px); background: rgba(255,255,255,.14); border: 1px solid rgba(255,255,255,.22); box-shadow: 0 20px 50px rgba(0,0,0,.25) }

    .card{ background: rgba(255,255,255,.92); border-radius: 18px; box-shadow: 0 22px 50px rgba(0,0,0,.18) }
    .dark .card{ background: rgba(17,24,39,.9); color:#e5e7eb; border:1px solid rgba(255,255,255,.06) }

    .f-input{ border:1px solid rgba(0,0,0,.1); border-radius:14px; padding:.85rem }
    .f-input:focus{ outline:none; box-shadow:0 0 0 3px rgba(99,102,241,.25); border-color:var(--indigo) }

    .btn{ border-radius:14px; padding:.85rem 1rem; font-weight:700; color:#fff; transition:transform .2s ease, box-shadow .2s ease; cursor:pointer }
    .btn-indigo{ background:linear-gradient(135deg,#6366f1,#8b5cf6) }
    .btn-green{ background:linear-gradient(135deg,#10b981,#22c55e) }
    .btn-blue{ background:linear-gradient(135deg,#2563eb,#06b6d4) }
    .btn-red{ background:linear-gradient(135deg,#ef4444,#f97316) }
    .btn-light{ background:#eef2ff; color:#4f46e5; font-weight:600 }

    .progress{ height:10px; background:linear-gradient(90deg,var(--indigo),var(--blue)); border-radius:12px; width:0%; transition:width .25s ease }

    .dropzone{ border:2px dashed rgba(0,0,0,.2); border-radius:14px; padding:18px; transition:.2s }
    .dropzone.drag{ border-color:#60a5fa; background:rgba(96,165,250,.08) }

    .history-item{ display:flex; align-items:center; justify-content:space-between; padding:.65rem .85rem; border-radius:12px; background:rgba(255,255,255,.65) }
    .dark .history-item{ background:rgba(255,255,255,.08) }

    .badge{ font-size:.72rem; padding:.22rem .55rem; border-radius:999px; background:rgba(255,255,255,.22); color:#fff }
  </style>
</head>
<body class="bg-animated">
  <div class="w-full max-w-7xl mx-auto my-8 md:my-12 glass rounded-3xl p-6 md:p-10 animate__animated animate__fadeIn">
    <div class="flex items-center justify-between mb-6">
      <div class="flex items-center gap-3">
        <h1 class="text-3xl md:text-5xl font-extrabold text-white drop-shadow">‚ö° Realtime File Share ‚Äî Simple</h1>
        <span class="badge hidden md:inline">12MB ‚Ä¢ No Text ‚Ä¢ Always Saved</span>
      </div>
      <div class="flex items-center gap-2">
        <button id="darkToggle" class="btn btn-light px-4 py-2">üåô Dark</button>
      </div>
    </div>

    <div class="grid lg:grid-cols-3 gap-6">
      <!-- Sender -->
      <div class="card p-6 space-y-4 lg:col-span-1">
        <h2 class="text-2xl text-indigo-700 dark:text-indigo-300">üì§ Sender</h2>
        <div class="flex gap-2">
          <input id="senderId" class="f-input flex-1" placeholder="Custom ID (optional)" aria-label="Custom ID"/>
          <button id="genId" class="btn btn-indigo">Generate</button>
          <button id="copyId" class="btn btn-light">Copy</button>
        </div>
        <div id="dropzone" class="dropzone">
          <label class="block text-sm font-semibold">Select file (‚â§ 12 MB)</label>
          <input id="fileInput" type="file" class="w-full f-input mt-2" />
          <p id="fileInfo" class="text-xs opacity-80 mt-1"></p>
        </div>
        <button id="sendBtn" class="btn btn-indigo w-full">üöÄ Send</button>
        <div class="mt-2"><div id="progress" class="progress" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"></div></div>
        <p id="status" class="text-sm"></p>
      </div>

      <!-- Receiver -->
      <div class="card p-6 lg:col-span-1">
        <h2 class="text-2xl text-green-700 dark:text-green-300">üì• Receiver</h2>
        <label class="block text-sm font-semibold mb-2">Enter ID to receive</label>
        <div class="flex gap-2 mb-4">
          <input id="receiverId" class="f-input flex-1" placeholder="ID to receive" aria-label="Receiver ID"/>
          <button id="openBtn" class="btn btn-green">üîç Open</button>
        </div>
        <div id="receiveBox" class="space-y-3"></div>
      </div>

      <!-- History -->
      <div class="card p-6 lg:col-span-1">
        <h2 class="text-2xl text-blue-700 dark:text-blue-300">üìú History</h2>
        <div class="flex gap-2 mb-4">
          <button id="tabSent" class="btn btn-light flex-1">Sent</button>
          <button id="tabRecv" class="btn btn-light flex-1">Received</button>
          <button id="clearAll" class="btn btn-red">Clear All</button>
        </div>
        <div id="histList" class="space-y-2 max-h-80 overflow-auto pr-1"></div>
      </div>
    </div>
  </div>

  <!-- Firebase v10 (ES Modules) -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js';
    import { getDatabase, ref, set, onValue, off, remove, get } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js';

    /* ---- Firebase Config (PUT REAL VALUES) ---- */
    const firebaseConfig = {
      apiKey: 'AIzaSyYOUR_KEY',
      authDomain: 'your-project.firebaseapp.com',
      databaseURL: 'https://your-project-default-rtdb.firebaseio.com',
      projectId: 'your-project',
      storageBucket: 'your-project.appspot.com',
      messagingSenderId: '0000000000',
      appId: '1:0000000000:web:xxxxxxxxxxxxxx'
    };

    const app = initializeApp(firebaseConfig);
    const db  = getDatabase(app);

    /* ---- Helpers ---- */
    const $ = id => document.getElementById(id);
    const asMB = b => (b/1024/1024).toFixed(2)+' MB';
    const MAX = 12 * 1024 * 1024; // 12MB
    function randomId(n=8){ const s='abcdefghijklmnopqrstuvwxyz0123456789'; let r=''; for(let i=0;i<n;i++) r+=s[Math.floor(Math.random()*s.length)]; return r }

    /* ---- Dark Mode ---- */
    const DARK_KEY='rfs-dark';
    function applyDark(on){ document.documentElement.classList.toggle('dark',on); document.body.classList.toggle('dark',on); $('darkToggle').textContent=on?'‚òÄÔ∏è Light':'üåô Dark'; localStorage.setItem(DARK_KEY,on?'1':'0') }
    $('darkToggle').addEventListener('click',()=>applyDark(!document.documentElement.classList.contains('dark')));
    (function(){ applyDark(localStorage.getItem(DARK_KEY)==='1') })();

    /* ---- IndexedDB (save forever until Clear) ---- */
    const idb = {
      db:null,
      async open(){ return new Promise((res,rej)=>{ const r=indexedDB.open('rfs-store',1); r.onupgradeneeded=()=>{ const db=r.result; if(!db.objectStoreNames.contains('files')) db.createObjectStore('files',{ keyPath:'key' }) }; r.onsuccess=()=>{ this.db=r.result; res(this.db) }; r.onerror=()=>rej(r.error) })},
      async put(obj){ const db=this.db||await this.open(); return new Promise((res,rej)=>{ const tx=db.transaction('files','readwrite'); tx.objectStore('files').put(obj); tx.oncomplete=()=>res(); tx.onerror=()=>rej(tx.error) })},
      async gets(){ const db=this.db||await this.open(); return new Promise((res,rej)=>{ const tx=db.transaction('files','readonly'); const req=tx.objectStore('files').getAll(); req.onsuccess=()=>res(req.result); req.onerror=()=>rej(req.error) })},
      async delAll(){ const db=this.db||await this.open(); return new Promise((res,rej)=>{ const tx=db.transaction('files','readwrite'); tx.objectStore('files').clear(); tx.oncomplete=()=>res(); tx.onerror=()=>rej(tx.error) })}
    };

    /* ---- History (localStorage metadata) ---- */
    const HSENT='rfs-h-sent', HREC='rfs-h-recv';
    const getH=k=>{ try{return JSON.parse(localStorage.getItem(k)||'[]')}catch{ return [] } };
    const putH=(k,a)=>localStorage.setItem(k,JSON.stringify(a));
    const addSent=i=>{ const a=getH(HSENT); a.unshift(i); putH(HSENT,a); renderHist() }
    const addRecv=i=>{ const a=getH(HREC); a.unshift(i); putH(HREC,a); renderHist() }
    let histTab='sent';
    function renderHist(){ const box=$('histList'); box.innerHTML=''; const data=histTab==='sent'?getH(HSENT):getH(HREC); if(!data.length){ box.innerHTML=`<div class="text-sm opacity-75">${histTab==='sent'?'No sent items yet':'No received items yet'}</div>`; return } data.slice(0,200).forEach(d=>{ const row=document.createElement('div'); row.className='history-item'; const openLink = d.localUrl ? `<a class=\"btn btn-blue px-3 py-2 text-white\" href=\"${d.localUrl}\" download=\"${d.name}\">Open</a>` : (d.link?`<a class=\"btn btn-blue px-3 py-2 text-white\" href=\"${d.link}\" target=\"_blank\">Open</a>`:''); row.innerHTML=`<div><div class="font-semibold">${d.name} <span class="text-xs opacity-70">(${d.size||''})</span></div><div class="text-xs opacity-70">${d.time} ‚Ä¢ ID: ${d.id}</div></div><div class="flex gap-2">${openLink}<button class="btn btn-light px-3 py-2" onclick="navigator.clipboard.writeText('${d.id}')">Copy ID</button></div>`; box.appendChild(row) }) }
    $('tabSent').onclick=()=>{ histTab='sent'; renderHist() }
    $('tabRecv').onclick=()=>{ histTab='recv'; renderHist() }

    /* ---- Drag & Drop ---- */
    const dz=$('dropzone');
    ['dragenter','dragover'].forEach(ev=>dz.addEventListener(ev,e=>{ e.preventDefault(); dz.classList.add('drag') }))
    ;['dragleave','drop'].forEach(ev=>dz.addEventListener(ev,e=>{ e.preventDefault(); dz.classList.remove('drag') }))
    dz.addEventListener('drop',e=>{ const f=e.dataTransfer.files?.[0]; if(f){ $('fileInput').files=e.dataTransfer.files; updateFileInfo(f) } })

    /* ---- File Info ---- */
    $('fileInput').addEventListener('change', e=>{ const f=e.target.files[0]; if(f) updateFileInfo(f) });
    function updateFileInfo(file){ $('fileInfo').textContent = `${file.name} ‚Ä¢ ${asMB(file.size)}` }

    /* ---- Sender ---- */
    $('genId').onclick=()=>{ const id=randomId(8); $('senderId').value=id; navigator.clipboard.writeText(id) };
    $('copyId').onclick=()=>{ const id=$('senderId').value.trim(); if(id) navigator.clipboard.writeText(id) };

    $('sendBtn').onclick=async ()=>{
      const file=$('fileInput').files[0]; if(!file) return statusMsg('‚ùå Please choose a file');
      if(file.size>MAX) return statusMsg(`‚ùå Max 12MB allowed (yours ${asMB(file.size)})`);

      let id=$('senderId').value.trim() || randomId(8); $('senderId').value=id;

      statusMsg('‚è≥ Reading file‚Ä¶');
      const buf = await file.arrayBuffer();
      const base64 = btoa(String.fromCharCode(...new Uint8Array(buf)));
      const dataUrl = `data:${file.type||'application/octet-stream'};base64,${base64}`;

      const payload={ name:file.name, size:file.size, data:dataUrl, time:new Date().toISOString() };

      statusMsg('‚¨ÜÔ∏è Uploading‚Ä¶');
      await set(ref(db,'files/'+id), payload);

      // Save locally forever (IndexedDB + history)
      const blob = new Blob([new Uint8Array(buf)], { type:file.type||'application/octet-stream' });
      const localKey = `sent:${id}:${file.name}:${Date.now()}`;
      await idb.put({ key:localKey, name:file.name, id, when:Date.now(), blob });
      const localUrl = URL.createObjectURL(blob);

      statusMsg(`‚úÖ Sent ${file.name} ‚Ä¢ ID: ${id}`);
      addSent({ id, name:file.name, time:new Date().toLocaleString(), size:asMB(file.size), link:location.origin+location.pathname+'?id='+id, localUrl });
      $('progress').style.width='100%'; $('progress').setAttribute('aria-valuenow','100');
      setTimeout(()=>{ $('progress').style.width='0%'; $('progress').setAttribute('aria-valuenow','0') },800);
    };

    function statusMsg(t){ $('status').textContent=t }

    /* ---- Receiver ---- */
    $('openBtn').onclick=()=>{ const id=$('receiverId').value.trim(); if(!id) return statusMsg('‚ùå Enter an ID to receive'); startReceive(id) };

    let currentRef=null;
    function stopReceive(){ if(currentRef){ off(currentRef); currentRef=null } }

    async function startReceive(id){
      stopReceive();
      const box=$('receiveBox'); box.innerHTML=`<div class="text-sm opacity-80">‚è≥ Listening for <b>${id}</b>‚Ä¶</div>`;
      currentRef = ref(db,'files/'+id);
      onValue(currentRef, async snap=>{
        const data=snap.val();
        if(!data){ box.innerHTML='<div class="text-red-600 font-semibold">‚ùå No file for this ID</div>'; return }

        // Build UI
        box.innerHTML = `
          <div class="p-4 rounded-xl bg-white dark:bg-gray-900 shadow animate__animated animate__fadeInUp">
            <div class="font-semibold mb-1">üìÑ ${data.name} <span class="text-xs opacity-70">(${asMB(data.size||0)})</span></div>
            <div class="text-xs opacity-70 mb-3">‚è± ${new Date(data.time).toLocaleString()} ‚Ä¢ ID: ${id}</div>
            <div class="flex gap-2 flex-wrap">
              <a id="dl" class="btn btn-blue px-4 py-2 text-white" href="#">‚¨á Download</a>
              <button id="saveLocal" class="btn btn-indigo px-4 py-2">üíæ Save Locally</button>
            </div>
          </div>`;

        const dlBtn=$('dl');
        const saveBtn=$('saveLocal');

        function dataUrlToBlob(url){ const b64=url.split(',')[1]; const bin=atob(b64); const arr=new Uint8Array(bin.length); for(let i=0;i<bin.length;i++) arr[i]=bin.charCodeAt(i); const mime=url.split(';')[0].slice(5)||'application/octet-stream'; return new Blob([arr],{type:mime}) }

        dlBtn.onclick=(e)=>{ e.preventDefault(); const a=document.createElement('a'); a.href=data.data; a.download=data.name||'download'; document.body.appendChild(a); a.click(); a.remove(); addRecv({ id, name:data.name, time:new Date().toLocaleString(), size:asMB(data.size||0), link:location.origin+location.pathname+'?id='+id }); };

        saveBtn.onclick=async ()=>{
          const blob=dataUrlToBlob(data.data);
          const localKey = `recv:${id}:${data.name}:${Date.now()}`;
          await idb.put({ key:localKey, name:data.name, id, when:Date.now(), blob });
          const localUrl = URL.createObjectURL(blob);
          addRecv({ id, name:data.name, time:new Date().toLocaleString(), size:asMB(data.size||0), localUrl });
        };
      });
    }

    /* ---- Clear All (local + remote entries you created) ---- */
    $('clearAll').onclick=async ()=>{
      if(!confirm('Clear local history & saved files? Sent IDs on server will also be removed.')) return;
      // remove remote for IDs we sent (best-effort)
      const sent=getH(HSENT);
      for(const s of sent){ try{ await remove(ref(db,'files/'+s.id)) }catch(e){} }
      // clear local
      localStorage.removeItem(HSENT); localStorage.removeItem(HREC); renderHist();
      await idb.delAll();
      $('receiveBox').innerHTML=''; $('status').textContent='üßπ Cleared';
    };

    // Initial render & load saved blobs to show open links
    renderHist();
    (async ()=>{
      const saved = await idb.gets();
      // enrich existing history entries with fresh object URLs
      function enrich(key){ const arr=getH(key); const byIdName=new Map(arr.map(x=>[x.id+'|'+x.name,x]));
        for(const f of saved){ const k=f.id+'|'+f.name; if(byIdName.has(k)){ const u=URL.createObjectURL(f.blob); byIdName.get(k).localUrl=u } }
        const out=[...byIdName.values()]; putH(key,out)
      }
      enrich(HSENT); enrich(HREC); renderHist();
    })();
  </script>

  <!-- Notes:
    ‚Ä¢ ‡§Ø‡§π ‡§∏‡§ø‡§Ç‡§™‡•ç‡§≤‡§ø‡§´‡§æ‡§á‡§° ‡§µ‡§∞‡•ç‡§ú‡§º‡§® ‡§∏‡§ø‡§∞‡•ç‡§´‡§º ‡§´‡§æ‡§á‡§≤ ‡§≠‡•á‡§ú‡§§‡§æ/‡§≤‡•á‡§§‡§æ ‡§π‡•à (‡§ü‡•á‡§ï‡•ç‡§∏‡•ç‡§ü/‡§è‡§®‡•ç‡§ï‡•ç‡§∞‡§ø‡§™‡•ç‡§∂‡§® ‡§π‡§ü‡§æ‡§Ø‡§æ ‡§ó‡§Ø‡§æ).
    ‚Ä¢ ‡§≤‡§ø‡§Æ‡§ø‡§ü 12MB ‡§π‡•à. Firebase ‡§Æ‡•á‡§Ç ‡§ï‡•ã‡§à expiry ‡§®‡§π‡•Ä‡§Ç ‚Äî ‡§°‡•á‡§ü‡§æ ‡§§‡§¨ ‡§§‡§ï ‡§∞‡§π‡•á‡§ó‡§æ ‡§ú‡§¨ ‡§§‡§ï ‡§π‡§ü‡§æ‡§Ø‡§æ ‡§® ‡§ú‡§æ‡§è.
    ‚Ä¢ ‡§≤‡•ã‡§ï‡§≤ ‡§Æ‡•á‡§Ç ‡§´‡§æ‡§á‡§≤‡•á‡§Ç IndexedDB ‡§Æ‡•á‡§Ç ‡§∏‡•á‡§µ ‡§∞‡§π‡§§‡•Ä ‡§π‡•à‡§Ç; Clear All ‡§™‡§∞ ‡§∏‡§¨ ‡§π‡§ü ‡§ú‡§æ‡§§‡§æ ‡§π‡•à.
    ‚Ä¢ ‡§ö‡§æ‡§π‡•á‡§Ç ‡§§‡•ã Firebase rules ‡§ï‡•ã ‡§ü‡•ç‡§Ø‡•Ç‡§® ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ auth/app check ‡§ú‡•ã‡§°‡§º‡•á‡§Ç.
  -->
</body>
</html>
