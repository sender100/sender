<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ðŸ”¥ Advanced Data Share</title>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getDatabase, ref, set, get, child, remove } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

    // --- Your Firebase Config ---
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT.firebaseapp.com",
      databaseURL: "https://YOUR_PROJECT.firebaseio.com",
      projectId: "YOUR_PROJECT",
      storageBucket: "YOUR_PROJECT.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Random ID
    function makeId(len = 6) {
      const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
      let res = "";
      for (let i = 0; i < len; i++) res += chars.charAt(Math.floor(Math.random() * chars.length));
      return res;
    }

    // Save to local history
    function saveHistory(type, id, name, base64) {
      let history = JSON.parse(localStorage.getItem("history") || "[]");
      history.push({ type, id, name, data: base64, time: new Date().toLocaleString() });
      localStorage.setItem("history", JSON.stringify(history));
      renderHistory();
    }

    // Render History
    function renderHistory() {
      let history = JSON.parse(localStorage.getItem("history") || "[]");
      const box = document.getElementById("historyBox");
      box.innerHTML = "";
      history.forEach((item, i) => {
        let div = document.createElement("div");
        div.className = "history-item";
        div.innerHTML = `
          <b>[${item.type}]</b> ${item.name} (ID: ${item.id}) <br>
          <small>${item.time}</small><br>
          <button onclick="downloadHistory(${i})">Download</button>
        `;
        box.appendChild(div);
      });
    }

    // Download from history
    window.downloadHistory = function(i) {
      let history = JSON.parse(localStorage.getItem("history") || "[]");
      let item = history[i];
      const a = document.createElement("a");
      a.href = item.data;
      a.download = item.name;
      a.click();
    }

    // Send
    window.sendData = async function() {
      const fileInput = document.getElementById("fileInput");
      if (!fileInput.files.length) {
        alert("Select a file first!");
        return;
      }
      const file = fileInput.files[0];
      if (file.size > 12 * 1024 * 1024) {
        alert("Max 12MB allowed!");
        return;
      }
      const reader = new FileReader();
      reader.onload = async function(e) {
        const base64Data = e.target.result;
        const id = makeId();
        await set(ref(db, "files/" + id), {
          name: file.name,
          type: file.type,
          data: base64Data
        });
        document.getElementById("shareId").innerHTML = `Your Share ID: <b>${id}</b>
          <button onclick="navigator.clipboard.writeText('${id}')">ðŸ“‹ Copy</button>`;
        saveHistory("Sent", id, file.name, base64Data);
      };
      reader.readAsDataURL(file);
    }

    // Receive
    window.receiveData = async function() {
      const id = document.getElementById("receiveId").value.trim();
      if (!id) { alert("Enter Share ID!"); return; }
      const snap = await get(child(ref(db), "files/" + id));
      if (!snap.exists()) { alert("No data found!"); return; }
      const fileData = snap.val();
      const a = document.createElement("a");
      a.href = fileData.data;
      a.download = fileData.name;
      a.click();
      saveHistory("Received", id, fileData.name, fileData.data);
    }

    // Clear All
    window.clearAll = async function() {
      await remove(ref(db, "files"));
      localStorage.removeItem("history");
      document.getElementById("historyBox").innerHTML = "";
      alert("Cleared everything!");
    }

    window.onload = renderHistory;
  </script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #36d1dc, #5b86e5);
      color: white;
      text-align: center;
      padding: 30px;
    }
    .box {
      background: rgba(0,0,0,0.4);
      padding: 20px;
      border-radius: 15px;
      margin: 20px auto;
      max-width: 600px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
      animation: fadeIn 1s;
    }
    button {
      background: #ff758c;
      border: none;
      padding: 10px 20px;
      margin: 8px;
      border-radius: 8px;
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: 0.3s;
    }
    button:hover { background: #ff4f70; }
    input {
      padding: 10px;
      border-radius: 6px;
      border: none;
      width: 80%;
      margin: 10px;
    }
    .history-item {
      background: rgba(255,255,255,0.1);
      margin: 8px;
      padding: 8px;
      border-radius: 6px;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  <h1>ðŸ”¥ Advanced Data Share</h1>

  <div class="box">
    <h2>Send File</h2>
    <input type="file" id="fileInput" />
    <br>
    <button onclick="sendData()">Send</button>
    <p id="shareId"></p>
  </div>

  <div class="box">
    <h2>Receive File</h2>
    <input type="text" id="receiveId" placeholder="Enter Share ID" />
    <br>
    <button onclick="receiveData()">Receive</button>
  </div>

  <div class="box">
    <h2>History</h2>
    <div id="historyBox"></div>
  </div>

  <div class="box">
    <h2>Admin</h2>
    <button onclick="clearAll()">Clear All</button>
  </div>
</body>
</html>
